!function(){function t(){return document.getElementById("backwpup-chatbot-modal")}function e(){return document.getElementById("backwpup-chatbot-iframe")}function a(a){var o=t(),n=e();o&&(n&&"string"==typeof a&&(n.src=a),o.classList.add("is-open"))}function o(){var a=t(),o=e();o&&(o.src="about:blank"),a&&a.classList.remove("is-open")}function n(t,e){var a,o=new URL(t),n=JSON.stringify(e),r=(a=encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}),window.btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""));return o.searchParams.set("context",r),e&&e.generated_at&&o.searchParams.set("generated_at",String(e.generated_at)),o.toString()}async function r(){if(window.BackWPupChatbot&&BackWPupChatbot.url)if(window.fetch)if("undefined"!=typeof URL){a("about:blank");try{var t=await fetch(BackWPupChatbot.contextEndpoint,{method:"POST",headers:{"X-WP-Nonce":BackWPupChatbot.nonce,"Content-Type":"application/json"},body:JSON.stringify({})});if(!t.ok)return alert("Could not create chatbot context."),void o();var r=await t.json(),c=r&&r.payload?r.payload:r,i=n(BackWPupChatbot.url,c),s=e();s?s.src=i:a(i)}catch(t){alert("Could not open chatbot."),o()}}else alert("Your browser does not support URL().");else alert("Your browser does not support fetch().");else alert(window.BackWPupChatbot&&BackWPupChatbot.i18n&&BackWPupChatbot.i18n.missingUrl||"Chatbot URL missing.")}document.addEventListener("click",function(t){if(t.target&&t.target.closest&&t.target.closest("#backwpup-open-chatbot"))return t.preventDefault(),void r();var e=t.target&&t.target.closest&&t.target.closest("[data-backwpup-chatbot-close]"),a=t.target&&"backwpup-chatbot-modal"===t.target.id;(e||a)&&(t.preventDefault(),o())}),document.addEventListener("keydown",function(t){"Escape"===t.key&&o()})}();